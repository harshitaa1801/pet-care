upstream django {
    # If you’re running `./manage.py runserver 0.0.0.0:8000` inside Docker,
    # and your Nginx is in another container named “eweb” in the same network,
    # pointing at “eweb:8000” is fine. Otherwise, use 127.0.0.1:8000.
    server web:8000;
}
resolver 127.0.0.11 valid=30s;
    
server {
    listen 80 default_server;
    server_name _;

    # Turn off tokens in dev if you like
    server_tokens off;

    # Proxy everything else to Django
    location / {
        proxy_pass         http://django;
        proxy_redirect     off;
        proxy_set_header   Host              $host;
        proxy_set_header   X-Real-IP         $remote_addr;
        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
    }

    # Static files
    location /static/ {
        # Must match Django’s STATIC_ROOT
        alias /home/app/static/;
        # If you see 404s here, double-check that collectstatic wrote into /home/app/static/
        try_files $uri $uri/ =404;
    }

    # Media uploads
    location /media/ {
        alias /home/app/media/;
        try_files $uri $uri/ =404;
    }

    # Optional: increase buffer sizes if you have large headers
    # proxy_buffer_size   128k;
    # proxy_buffers       4 256k;
    # proxy_busy_buffers_size 256k;
}
